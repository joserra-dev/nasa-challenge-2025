<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Costal Savior - NASA Space Apps</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <header>
            <h1>🌊 Costal Savior</h1>
            <div id="resources">
                <span>💰 Budget: <span id="money" class="resource-value">100</span></span>
                <span>😊 Wellbeing: <span id="wellbeing" class="resource-value">50</span></span>
                <span>🌿 Environment: <span id="environment" class="resource-value">50</span></span>
                <span>🛡️ Resilience: <span id="resilience" class="resource-value">20</span></span>
                <span>📅 Year: <span id="year" class="resource-value">2025</span></span>
            </div>
        </header>

        <main>
            <div id="game-board">
                <!-- Board generated dynamically -->
            </div>

            <div id="control-panel">
                <h3>Actions</h3>
                <div class="action-buttons">
                    <button onclick="buildStructure('residential')">🏠 Residential Zone (+Wellbeing, -Environment)</button>
                    <button onclick="buildStructure('industrial')">🏭 Industrial Zone (+Money, -Environment)</button>
                    <button onclick="buildStructure('mangrove')">🟢 Restore Mangrove (+Environment, +Resilience)</button>
                    <button onclick="buildStructure('seawall')">🛡️ Build Seawall (+Resilience, -Money)</button>
                    <button id="consult-ai-btn">📡 Consult AI</button>

                </div>
                
                <div class="save-controls">
                    <button onclick="manualSave()">💾 Save</button>
                    <button onclick="manualLoad()">📂 Load</button>
                    <button onclick="newGame()">🔄 New Game</button>
                    <button onclick="viewStats()">📊 Statistics</button>
                </div>

                <button id="next-turn-btn" onclick="nextTurn()">Next Turn (5 years)</button>

                <!-- NASA Panel -->
                <div id="nasa-data-panel" class="nasa-data-update">
                    <!-- Will be filled dynamically from JS -->
                </div>
            </div>
            <div style="text-align: center; margin-bottom: 10px;">
                <a href="https://github.com/joserra-dev/nasa-challenge-2025" target="_blank" style="color: #2c3e50; text-decoration: none; font-size: 0.9em; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 15px; display: inline-block; transition: all 0.3s ease;">
                    💻 View Source Code on GitHub
                </a>
            </div>
        </main>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="event-title">Climate Event</h2>
            <p id="event-description"></p>
            <button onclick="closeEventModal()">Continue</button>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="stats-modal" class="modal hidden">
        <div class="modal-content">
            <h2>📊 Game Statistics</h2>
            <div id="stats-content">
                <!-- Dynamic content -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button onclick="closeStatsModal()">Close</button>
                <button onclick="exportSave()">📤 Export Game</button>
                
                <input type="file" id="import-file" accept=".json" style="display: none;">
                <button onclick="document.getElementById('import-file').click()">📥 Import Game</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="data.js"></script>
    <script src="nasa-api.js"></script>
    <script src="save-manager.js"></script>
    <script src="game.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Import games
            const importFile = document.getElementById('import-file');
            if (importFile) {
                importFile.addEventListener('change', function(e) {
                    if (e.target.files[0]) {
                        importSave(e.target.files[0]);
                    }
                });
            }

            // Initial NASA animation
            const nasaPanel = document.getElementById('nasa-data-panel');
            if (nasaPanel) {
                nasaPanel.classList.add('nasa-data-update');
            }
        });
    </script>
    <script>
        // const OPENAI_API_KEY = "tu_api_key_aqui"; // ⚠️ solo para pruebas locales
		// const GEMINI_API_KEY = ""; // ⚠️ solo para pruebas locales

    </script>


    AI Modal
    <div id="ai-modal" class="modal hidden">
    <div class="modal-content ai-modal">
        <h2>Climate AI Advisor</h2>
        <div id="ai-response">
        <p>The AI will analyze your current game state and NASA data to recommend the best strategy.</p>
        </div>
        <button onclick="closeAIModal()">Close</button>
    </div>
</div>
<!-- API Config Modal -->
<div id="api-config-modal" class="modal hidden" style="z-index:9999;">
  <div class="modal-content" style="max-width:520px;padding:16px;background:white;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,.2);margin:6% auto;">
    <h3>Configure AI Service</h3>
    <p>Choose the provider and paste your API Key. <strong>Do not share your key publicly.</strong></p>

    <label for="api-provider">Provider</label>
    <select id="api-provider" style="width:100%;margin-bottom:8px;padding:8px;">
      <option value="gemini">Gemini (Google)</option>
      <option value="openai">OpenAI</option>
      <option value="other">Other</option>
    </select>

    <label for="api-key">API Key</label>
    <input id="api-key" type="text" placeholder="sk-..." style="width:100%;padding:8px;margin-bottom:8px;" />

    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
      <input id="api-remember" type="checkbox" />
      <label for="api-remember">Remember me on this device (persistent)</label>
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button id="api-cancel-btn" class="btn">Cancel</button>
      <button id="api-save-btn" class="btn primary">Save and Consult</button>
    </div>

    <small style="display:block;margin-top:8px;color:#666;">
      Note: Saving the key in the browser involves risks. For production, manage keys in a secure backend.
    </small>
  </div>
</div>


</body>
</html>
